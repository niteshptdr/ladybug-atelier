{% extends 'base.html' %}
{% load static %}


{% block content %}


<!-- <div class="relative w-full h-[60vh] sm:h-[80vh] md:h-[40vh] overflow-hidden"> -->
  
<!-- <div class="relative w-full h-80 sm:h-96 md:h-[28rem] overflow-hidden">

  <img src="{% static 'images/cover.jpg' %}" alt="Boutique Banner" class="object-cover w-full h-full" />
  <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center px-4">
    <div class="text-center text-white">
      <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold mb-4 shadow">
        Standard Sizes? We Don’t Think So!
      </h1>
      <p class="text-base sm:text-lg md:text-xl shadow-sm">
        We believe fashion isn’t about fitting into a mold — it’s about celebrating individuality. Choose exclusive, customized sizes, styles, and fabrics tailored just for you.
      </p>
    </div>
  </div>

</div> -->



<div 
  x-data="carousel()" 
  x-init="start()" 
  @touchstart="startTouch($event)" 
  @touchend="endTouch($event)"
  class="relative w-full overflow-hidden px-2 py-2"
>

  <!-- Slides -->
  <!-- <div class="relative h-[40vh] sm:h-[40vh] lg:h-[70vh] rounded-2xl overflow-hidden"> -->
    <div class="relative w-full aspect-[16/6] rounded-xl overflow-hidden">
    <template x-for="(slide, index) in slides" :key="index">
      <div
        x-show="current === index" 
        x-transition 
        class="absolute inset-0 w-full h-full"
      >
        <img :src="slide.image" :alt="slide.alt" class="w-full h-full object-cover rounded-2xl" />
        <!-- <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-40 text-white text-center py-2 text-lg font-semibold">
          <span x-text="slide.caption"></span>
        </div> -->
      </div>
    </template>
  </div>

  <!-- Dots -->
  <div class="flex justify-center mt-1 space-x-2">
    <template x-for="(slide, index) in slides" :key="index">
      <button 
        @click="goTo(index)" 
        :class="{
          'bg-rose-600': current === index,
          'bg-gray-300': current !== index
        }" 
        class="w-2 h-2 rounded-full transition duration-300"
      ></button>
    </template>
  </div>
</div>

<h2 class="text-xl sm:text-2xl font-bold mt-0 mb-0 text-center">Start Customizing</h2>
<div class="flex justify-center px-2 hover:cursor-pointer hover:scale-102 transition duration-300" onclick="window.location.href='/select-category'">
  <div class="relative w-full aspect-[15/3] lg:w-[50rem] rounded-xl shadow-lg overflow-hidden">
    
      <div
        class="absolute h-full"
      >
        <img src="{{create_style_card.image.url}}" alt="" class="h-full object-cover rounded-2xl" />

      </div>
    
  </div>
</div>

<h2 class="text-xl sm:text-2xl font-bold mt-2 mb-0 text-center">Most Viewed</h2>

<div class="flex overflow-x-auto space-x-6 pb-4 mb-4 scroll-smooth snap-x px-2">
    <div class="flex justify-center gap-4 snap-x">
          {% for product in products_by_view %}
        <a href="{% url 'product-detail' product.id %}" class="{% if product.fabric.units_inStock <= 0 %}opacity-50 pointer-events-none{% endif %}">
            <div class="bg-white shadow p-0 text-center rounded w-48" >
                <div class="product-image-wrapper aspect-w-1 aspect-h-1 rounded">
                    {% if product.images.all|length > 0 %}
                        <img src="{{ product.images.all.0.image.url }}" alt="{{ product.images.all.0.alt_text }}" class="w-full h-auto object-cover">
                        {% if product.images.all|length > 1 %}
                            <img src="{{ product.images.all.1.image.url }}" alt="{{ product.images.all.1.alt_text }}" class="w-full h-auto object-cover hover-image">
                        {% endif %}
                    {% endif %}
                </div>

                <h2 class="text-sm text-gray-800 font-semibold bg-gray-200">{{ product.name }}</h2>
                <p class="text-xs ">{{ product.Category.category }}</p>
                
                <div class="">
                    <span class="text-xs font-bold text-gary-800">
                        ₹{{ product.final_price|floatformat:2 }}
                    </span>
                    {% if product.original_price %}
                        <span class="text-xs line-through text-gray-500 ml-2">
                            ₹{{ product.original_price|floatformat:2 }}
                        </span>
                    {% endif %}
                      
                      {% if product.final_price < product.price %}
                          <p class="text-green-500 text-xs ml-1">Flat Discount Applied</p>
                      {% endif %}
                </div>

                

                <div class="flex items-center justify-center space-x-1 mt-1 shrink-0">
                  
                {% with rating=product.average_rating|default:0 %}
                  {% if rating > 0 %}
                    {% for i in "12345" %}
                      {% with star_num=forloop.counter %}
                        <svg class="w-4 h-4 {% if star_num <= rating %}text-gray-600{% else %}text-gray-300{% endif %}" 
                            fill="currentColor" viewBox="0 0 20 20">
                          <path d="M10 1l2.39 5.99H18l-4.9 4.12 1.82 6.01L10 13.77l-4.92 3.35L6.9 11.1 2 6.99h5.61z" />
                        </svg>
                      {% endwith %}
                    {% endfor %}
                    <span class="text-xs text-gray-600 ml-1">{{ rating|floatformat:1 }}/5</span>
                    <p class="text-xs text-gray-600">({{product.total_reviews}})</p>
                  {% else %}
                  <div class="text-xs text-gray-400 italic text-center w-full"> Start the trend – rate it! </div>
                  {% endif %}
                {% endwith %}
                
              </div>
              
              <div class="flex items-center justify-center mt-1 text-gray-500 text-xs">
                <i class="fa fa-eye mr-1 text-gray-400"></i>
                {{ product.views }} views
              </div>
                              <!-- Out of Stock Badge -->
                  {% if product.fabric.units_inStock <= 0 %}
                  <div class="absolute top-2 right-2 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded">
                      Out of Stock
                  </div>
                  {% endif %}
            </div>
        </a>
        {% endfor %}
    </div>
</div>


<h2 class="text-xl sm:text-2xl font-bold mb-0 text-center">Discover More</h2>

<div class="flex overflow-x-auto space-x-6 pb-4 mb-4 scroll-smooth snap-x px-4">
    <div class="flex justify-center gap-4 snap-x">
          {% for product in products_by_date %}
        <a href="{% url 'product-detail' product.id %}" class="{% if product.fabric.units_inStock <= 0 %}opacity-50 pointer-events-none{% endif %}">

          <div class="relative bg-white shadow p-0 text-center rounded w-48" >
                <div class="product-image-wrapper aspect-w-1 aspect-h-1 rounded">
                    {% if product.images.all|length > 0 %}
                        <img src="{{ product.images.all.0.image.url }}" alt="{{ product.images.all.0.alt_text }}" class="w-full h-auto object-cover">
                        {% if product.images.all|length > 1 %}
                            <img src="{{ product.images.all.1.image.url }}" alt="{{ product.images.all.1.alt_text }}" class="w-full h-auto object-cover hover-image">
                        {% endif %}
                    {% endif %}
                </div>

                <h2 class="text-sm text-gray-800 font-semibold bg-gray-200">{{ product.name }}</h2>
                <p class="text-xs ">{{ product.Category.category }}</p>
                
                <div class="">
                    <span class="text-xs font-bold text-gary-800">
                        ₹{{ product.price|floatformat:2 }}
                    </span>
                    {% if product.original_price %}
                        <span class="text-xs line-through text-gray-500 ml-2">
                            ₹{{ product.original_price|floatformat:2 }}
                        </span>
                    {% endif %}
                </div>

                

                <div class="flex items-center justify-center space-x-1 mt-1 shrink-0">
                  
                {% with rating=product.average_rating|default:0 %}
                  {% if rating > 0 %}
                    {% for i in "12345" %}
                      {% with star_num=forloop.counter %}
                        <svg class="w-4 h-4 {% if star_num <= rating %}text-gray-600{% else %}text-gray-300{% endif %}" 
                            fill="currentColor" viewBox="0 0 20 20">
                          <path d="M10 1l2.39 5.99H18l-4.9 4.12 1.82 6.01L10 13.77l-4.92 3.35L6.9 11.1 2 6.99h5.61z" />
                        </svg>
                      {% endwith %}
                    {% endfor %}
                    <span class="text-xs text-gray-600 ml-1">{{ rating|floatformat:1 }}/5</span>
                    <p class="text-xs text-gray-600">({{product.total_reviews}})</p>
                  {% else %}
                  <div class="text-xs text-gray-400 italic text-center w-full"> Start the trend – rate it! </div>
                  {% endif %}
                {% endwith %}
                
              </div>

              <div class="flex items-center justify-center mt-1 text-gray-500 text-xs">
                <i class="fa fa-eye mr-1 text-gray-400"></i>
                {{ product.views }} views
              </div>
              
              <!-- Out of Stock Badge -->
              {% if product.fabric.units_inStock <= 0 %}
              <div class="absolute top-2 right-2 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded">
                  Out of Stock
              </div>
              {% endif %}

            </div>
        </a>
        {% endfor %}
    </div>
</div>




<!-- 
<div class="mt-8 px-4">
  <h2 class="text-xl sm:text-2xl font-bold mb-6 text-center">Shop by Category</h2>

  <div class="w-full flex flex-wrap justify-center gap-6 max-w-5xl mx-auto">
    {% for category in categories %}
    <a href="{% url 'products' %}" class="group block w-24 sm:w-28 text-center">

      <div class="w-24 h-24 sm:w-28 sm:h-28 mx-auto rounded-xl overflow-hidden border-2 border-rose-100 group-hover:border-rose-400 shadow-md">
        <img src="{{ category.image.url }}" alt="{{ category.name }}" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105" />
      </div>

      <p class="mt-2 text-sm font-medium text-gray-800 group-hover:text-rose-600 truncate">
        {{ category.name }}
      </p>
    </a>
    {% endfor %}
  </div>
</div> -->


<script>
function carousel() {
  return {
    current: 0,
    interval: null,
    startX: 0,
    endX: 0,
    slides: [
      {% for image in carousel_images %}
      {
        image: "{{ image.image.url }}",
        alt: "{{ image.alt_text|escapejs }}",
        caption: "{{ image.caption|escapejs }}"
      },
      {% endfor %}
    ],

    start() {
      this.interval = setInterval(() => this.next(), 4000)
    },

    next() {
      this.current = (this.current + 1) % this.slides.length
    },

    prev() {
      this.current = (this.current - 1 + this.slides.length) % this.slides.length
    },

    goTo(index) {
      this.current = index
    },

    startTouch(event) {
      this.startX = event.touches[0].clientX
    },

    endTouch(event) {
      this.endX = event.changedTouches[0].clientX
      const delta = this.endX - this.startX

      if (Math.abs(delta) > 50) {
        if (delta < 0) {
          this.next()
        } else {
          this.prev()
        }
      }
    }
  }
}
</script>

<!-- 

<div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-4">
  

  <div class="rounded-lg shadow-lg p-6 bg-white flex flex-col items-center justify-center text-center">
    <h2 class="font-bold text-xl mb-2">Create Your Style</h2>
    <p class="text-gray-700 mb-4">
      Utilize various Style options and Fabrics to get a perfect fit for your measurements.
    </p>
    <button type="button" class="bg-pink-600 hover:bg-pink-700 text-white font-semibold py-2 px-4 rounded-2xl"
    onclick="window.location.href='/select-fabric'">
      Create Style
    </button>
  </div>


  <div class="rounded-lg shadow-lg p-6 bg-white flex flex-col items-center justify-center text-center">
    <h2 class="font-bold text-xl mb-2">Explore Exclusive Products</h2>
    <p class="text-gray-700 mb-4">
      Choose from a wide variety of pre-designed styles that can be tailored to your measurements.
    </p>
    <button type="button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-2xl"
    onclick="window.location.href='/products'">
      Explore
    </button>
  </div>

</div> -->

{% endblock %}