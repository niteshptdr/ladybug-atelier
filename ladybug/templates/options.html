{% extends "base.html" %}
{% block content %}
<div class="max-w-3xl mx-auto px-4 py-8">

<div class=" bg-white border border-pink-200 rounded-xl p-2 shadow-sm mb-6">
  <div class="lg:grid lg:grid-cols-2">
    <div class="px-4 rounded bg-white"> 
      {% if request.session.own_fabric %}
        <h3 class="text-md font-semibold text-gray-600"> 
          <i class="fas fa-scissors text-pink-600 mr-1"></i>
          Fabric: Your Fabric </h3>
        {% if request.session.pickup %}
          <p class="text-sm text-gray-600 ms-6"> 
            <i class="fas fa-truck text-gray-600 mr-1"></i>
            Pickup will be arranged by Ladybug </p>
            
          {% else %}
          <p class="text-sm text-gray-600 ms-6"> 
            <i class="fas fa-box text-gray-600 mr-1"></i>
            Send your fabric to Ladybug</p>
        {% endif %}
      {% else %}

      <h3 class="text-md font-semibold text-gray-600 mb-2">
        <i class="fas fa-scissors text-pink-600 mr-1"></i>
        Fabric: {{ selected_fabric.name }}  </h3>
      <img id="fabric_thumbnail" src="{{ selected_fabric.images.first.image.url }}" alt="" class="ms-6 h-12 aspect-[15/10] object-cover rounded-xl hover:cursor-pointer"
      onclick="openImageModal('{{ selected_fabric.images.first.image.url }}')">

        {% endif %}
    </div>

    <div class="px-4 rounded bg-white"> 
      <h3 class="text-md font-semibold text-gray-600">
        <i class="fas fa-tshirt text-pink-600 mr-1"></i>
        Style: {{ selected_style.name }}  </h3>
      <img id="style_thumbnail" src="{{ selected_style.images.first.image.url }}" alt="" class="ms-6 h-12 aspect-[15/10] object-cover rounded-xl hover:cursor-pointer"
        onclick="openImageModal('{{ selected_style.images.first.image.url }}')">
        
    </div>
  
    <div class="px-4 rounded bg-white">
      <h3 class="text-md font-semibold text-gray-600"> 
        <i class="fas fa-arrows-alt-h text-pink-600 mr-1"></i>
        Measurements</h3>
      {% for key, value in measurements.items %}
        <p class="text-sm text-gray-600 ms-6">
          {{key}}: {{value}}</p>
      {% endfor %}
    </div>

    <div class="px-4 rounded bg-white">

    </div>

  </div>
  
  <div class="mt-3 ms-4">
    <a href="{% url 'select-style' %}" 
      class="inline-flex items-center gap-1 text-sm text-pink-600 font-medium hover:text-pink-700 transition duration-150 ease-in-out">
      <i class="fas fa-arrow-left"></i>
      Back
    </a>
  </div>
</div>


  <h2 class="text-3xl font-bold text-center text-gray-800 mb-8">Give Preferences</h2>

  <form method="post" class="space-y-4" id="measurementForm">
    {% csrf_token %}

    <div id="accordion" class="space-y-4">
      {% for field in form %}
            

        {% for guide in measurement_guides %}
       
          {% if guide.name == field.name %}
          <div class="border border-gray-200 rounded-xl shadow-sm transition-all duration-300 overflow-hidden">
            <button
              type="button"
              class="w-full flex justify-between items-center px-6 py-4 bg-gray-50 hover:bg-gray-100 rounded-t-xl font-semibold text-left text-pink-700 text-lg accordion-toggle"
              data-target="section-{{ forloop.parentloop.counter0 }}"
            >
              <span>{{ guide.name|title }}</span>
              <svg class="h-5 w-5 transition-transform duration-300 text-pink-600 accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>

            <div id="section-{{ forloop.parentloop.counter0 }}" class="accordion-content hidden px-6 pb-6 pt-4 bg-white">
              <div class="flex flex-col sm:flex-row gap-6 items-center mb-4">
                <img src="{{ guide.image.url }}" alt="{{ guide.name }}" class="w-40 h-40 object-contain rounded-md border border-gray-200 shadow">
                <div>
                  <h3 class="text-lg font-semibold text-gray-800 mb-1">{{ guide.name|title }}</h3>
                  <p class="text-gray-600 text-sm">{{ guide.description }}</p>
                </div>
              </div>

              <div>
                {{field}}

                <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ field.label }}</label>
                  <!-- <input 
                      type="text"
                      name="{{ field.name }}"
                      id="{{ field.id_for_label }}"
                      value="{{ field.value|default_if_none:'' }}"
                      class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-pink-500"
                      
                  > -->
                <!-- {% if field.errors %}
                  <p class="text-red-500 text-xs mt-1">{{ field.errors.0 }}</p>
                {% endif %} -->
              </div>
            </div>
          </div>
          {% endif %}
        {% endfor %}
      {% endfor %}
    </div>

    <div class="text-center pt-6">
      <button type="submit" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg">
        Add to Cart
      </button>
    </div>
  </form>


  {% if form.errors %}
<script>
  document.addEventListener("DOMContentLoaded", function() {
    const errors = [];

    {% for field in form %}
      {% for error in field.errors %}
        errors.push("{{ field.label }}: {{ error|escapejs }}");
      {% endfor %}
    {% endfor %}

    if (errors.length > 0) {
      Swal.fire({
        title: 'Invalid Measurements',
        html: errors.join('<br>'),
        icon: 'error',
        confirmButtonColor: '#e91e63'
      });
    }
  });
</script>
{% endif %}


</div>

<!-- Tailwind-compatible Vanilla JS for accordion -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const toggles = document.querySelectorAll('.accordion-toggle');
    const contents = document.querySelectorAll('.accordion-content');
    const icons = document.querySelectorAll('.accordion-icon');

    toggles.forEach((toggle, index) => {
      toggle.addEventListener('click', function () {
        const targetId = toggle.getAttribute('data-target');

        contents.forEach((content, i) => {
          if (content.id === targetId) {
            const isOpen = !content.classList.contains('hidden');
            content.classList.toggle('hidden', isOpen);
            icons[i].classList.toggle('rotate-180', !isOpen);
          } else {
            content.classList.add('hidden');
            icons[i].classList.remove('rotate-180');
          }
        });
      });
    });
  });
</script>
{% endblock %}
